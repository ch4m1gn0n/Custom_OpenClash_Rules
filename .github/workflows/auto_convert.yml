name: Auto Convert Surge List to Clash YAML

# è§¦å‘æ¡ä»¶
on:
  push:
    branches:
      - main
    paths:
      - '**.list'
      - 'scripts/convert_surge_to_clash.py'
      - '.github/workflows/auto_convert.yml' # å»ºè®®æŠŠ workflows å˜åŠ¨ä¹ŸåŠ ä¸Š
  workflow_dispatch:
  schedule:
    - cron: '0 22 * * *'  # æ¯å¤©åŒ—äº¬æ—¶é—´ 06:00 è¿è¡Œ

jobs:
  convert_and_push:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install dependencies
        run: |
          pip install pyyaml

      - name: Download Upstream Rules
        run: |
          # å»ºç«‹ rule ç›®å½•ï¼Œç¡®ä¿ wget ä¸ä¼šæŠ¥é”™
          mkdir -p ./rule
          
          # ä¸‹è½½æ–‡ä»¶
          echo "æ­£åœ¨ä¸‹è½½ GoogleCN.list..."
          wget https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/GoogleCN.list -O ./rule/GoogleCN.list
          
          # éªŒè¯æ–‡ä»¶æ˜¯å¦ä¸‹è½½æˆåŠŸï¼ˆå¯é€‰ï¼Œæ–¹ä¾¿è°ƒè¯•ï¼‰
          ls -lh ./rule/GoogleCN.list

      - name: Run Conversion Script
        run: |
          python scripts/convert_surge_to_clash.py

      - name: Commit and Push changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "ğŸ¤– Auto-update: Sync upstream rules & Regenerate YAML"
          # âš ï¸ ä¿®æ”¹é‡ç‚¹ï¼šå»æ‰ file_patternï¼Œæˆ–è€…æ˜¾å¼åŒ…å« .list
          # å»ºè®®ç›´æ¥åˆ æ‰ file_pattern è¡Œï¼Œé»˜è®¤æäº¤æ‰€æœ‰å˜åŠ¨
          # æˆ–è€…å†™æˆä¸‹é¢è¿™æ ·ï¼š
          file_pattern: 'rule/*.list **/*.yaml'